# ðŸ”„ Google OAuth Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GOOGLE OAUTH LOGIN FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   USER                 FRONTEND              NEXTAUTH           BACKEND          GOOGLE
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚  1. Click "Google"   â”‚                      â”‚                 â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚ 2. signIn("google")  â”‚                 â”‚               â”‚
    â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚ 3. Redirect     â”‚               â”‚
    â”‚                      â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                                                                â”‚
    â”‚  4. Google Login Page                                                         â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                                â”‚
    â”‚  5. User Authorizes                                                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                                                                â”‚
    â”‚                      â”‚                      â”‚ 6. Callback     â”‚               â”‚
    â”‚                      â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚ 7. User Profile â”‚               â”‚
    â”‚                      â”‚                      â”‚ + OAuth ID      â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚ 8. POST /oauth  â”‚               â”‚
    â”‚                      â”‚                      â”‚    { email,     â”‚               â”‚
    â”‚                      â”‚                      â”‚      name,      â”‚               â”‚
    â”‚                      â”‚                      â”‚      oauth_id,  â”‚               â”‚
    â”‚                      â”‚                      â”‚      avatar }   â”‚               â”‚
    â”‚                      â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚ 9. Check DB   â”‚
    â”‚                      â”‚                      â”‚                 â”‚    User exists?
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚ 10a. If NO:   â”‚
    â”‚                      â”‚                      â”‚                 â”‚    CREATE userâ”‚
    â”‚                      â”‚                      â”‚                 â”‚    with OAuth â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚ 10b. If YES:  â”‚
    â”‚                      â”‚                      â”‚                 â”‚    LINK OAuth â”‚
    â”‚                      â”‚                      â”‚                 â”‚    to existingâ”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚ 11. Return      â”‚               â”‚
    â”‚                      â”‚                      â”‚    { tokens,    â”‚               â”‚
    â”‚                      â”‚                      â”‚      user }     â”‚               â”‚
    â”‚                      â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚ 12. Session with    â”‚                 â”‚               â”‚
    â”‚                      â”‚     tokens & user    â”‚                 â”‚               â”‚
    â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚  13. useEffect       â”‚                      â”‚                 â”‚               â”‚
    â”‚      detects session â”‚                      â”‚                 â”‚               â”‚
    â”‚      - Save tokens   â”‚                      â”‚                 â”‚               â”‚
    â”‚      - Show toast    â”‚                      â”‚                 â”‚               â”‚
    â”‚      - Redirect      â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚  14. Dashboard Page  â”‚                      â”‚                 â”‚               â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
    â”‚   âœ… LOGGED IN! âœ…  â”‚                      â”‚                 â”‚               â”‚
    â”‚                      â”‚                      â”‚                 â”‚               â”‚
```

## ðŸ“Š Database Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE OPERATIONS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    EXISTING USER              NEW USER                LINKED ACCOUNT
         â”‚                         â”‚                          â”‚
         â”‚                         â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Check DB â”‚            â”‚  Check DB  â”‚            â”‚  Check DB   â”‚
    â”‚  Found!  â”‚            â”‚ Not Found! â”‚            â”‚   Found!    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚ No OAuth!   â”‚
         â”‚                         â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  Update  â”‚            â”‚   CREATE   â”‚            â”‚   UPDATE    â”‚
    â”‚  OAuth   â”‚            â”‚    user    â”‚            â”‚  Link OAuth â”‚
    â”‚  Fields  â”‚            â”‚   with:    â”‚            â”‚   Fields:   â”‚
    â”‚          â”‚            â”‚ - name     â”‚            â”‚ - provider  â”‚
    â”‚ - avatar â”‚            â”‚ - email    â”‚            â”‚ - oauth_id  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚ - oauth_id â”‚            â”‚ - avatar    â”‚
         â”‚                  â”‚ - provider â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚ - avatar   â”‚                   â”‚
         â”‚                  â”‚ - verified â”‚                   â”‚
         â”‚                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
         â”‚                         â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚  Generate  â”‚
            â”‚    JWT     â”‚
            â”‚   Tokens   â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚   Return   â”‚
            â”‚   to App   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ—„ï¸ Database Schema Changes

```sql
-- BEFORE (Original Schema)
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(50),
    password VARCHAR(255) NOT NULL,  â† Required
    role VARCHAR(50) DEFAULT 'user',
    ...
);

-- AFTER (With OAuth Support)
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(50),
    password VARCHAR(255),              â† Now Optional
    role VARCHAR(50) DEFAULT 'user',
    oauth_provider VARCHAR(50),         â† NEW
    oauth_id VARCHAR(255),              â† NEW
    email_verified BOOLEAN,             â† NEW
    ...
);
```

## ðŸ” Authentication Methods

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER LOGIN OPTIONS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    TRADITIONAL LOGIN          GOOGLE OAUTH           BOTH LINKED
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Email/Pass   â”‚          â”‚   Google     â”‚      â”‚ Email/Pass   â”‚
    â”‚              â”‚          â”‚              â”‚      â”‚     OR       â”‚
    â”‚ password: âœ“  â”‚          â”‚ password: âœ—  â”‚      â”‚   Google     â”‚
    â”‚ oauth_id: âœ—  â”‚          â”‚ oauth_id: âœ“  â”‚      â”‚              â”‚
    â”‚              â”‚          â”‚              â”‚      â”‚ password: âœ“  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ oauth_id: âœ“  â”‚
                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â€¢ Requires OTP           â€¢ Instant login         â€¢ Can use either
    â€¢ Must know password     â€¢ No password needed    â€¢ Most flexible
    â€¢ Manual registration    â€¢ Auto-registration     â€¢ Best UX
```

## ðŸ“ File Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FILE STRUCTURE                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

app/
â”œâ”€â”€ layout.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â”‚ Wraps with
â”‚                        â–¼
â”œâ”€â”€ components/
â”‚   â””â”€â”€ AuthProvider.tsx â”€â”€â”€â”€â”€â”€â–º SessionProvider (from next-auth)
â”‚
â”œâ”€â”€ login/
â”‚   â””â”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Uses: useSession, signIn
â”‚                                  Calls: handleGoogleSignIn()
â”‚
â””â”€â”€ api/auth/[...nextauth]/
    â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º NextAuth Config
                â”‚                   - Google Provider
                â”‚                   - Callbacks
                â”‚                   - Session Strategy
                â”‚
                â””â”€â”€â–º Calls Backend: /api/auth/oauth/google
                                   â”‚
                                   â–¼
                            server/routes/authRoutes.js
                                   â”‚
                                   â–¼
                            server/controllers/authController.js
                                   â”‚
                                   â–¼
                            googleOAuth() function
                                   â”‚
                                   â–¼
                            PostgreSQL Database
```

## ðŸŽ¯ Token Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TOKEN FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Backend generates:
    accessToken  (15 min) â”€â”€â”€â”€â”€â”
    refreshToken (7 days) â”€â”€â”€â”€â”€â”¤
                               â”‚
                               â”œâ”€â”€â–º Returned to NextAuth
                               â”‚
                               â”œâ”€â”€â–º Stored in session
                               â”‚
                               â””â”€â”€â–º Passed to frontend
                                    â”‚
                                    â–¼
                            useEffect in login page
                                    â”‚
                                    â”œâ”€â”€â–º localStorage.setItem("accessToken")
                                    â”œâ”€â”€â–º localStorage.setItem("refreshToken")
                                    â””â”€â”€â–º localStorage.setItem("user")
                                          â”‚
                                          â–¼
                                    Used for API calls
```

---

## ðŸŽ¨ User Experience Flow

```
1. USER SEES:        [Login Page]
                     â”œâ”€â”€ Email input
                     â”œâ”€â”€ Password input
                     â”œâ”€â”€ "Login" button
                     â”œâ”€â”€ â”€â”€â”€ OR â”€â”€â”€
                     â””â”€â”€ ðŸ”µ "Continue with Google" â† NEW!

2. USER CLICKS:      ðŸ”µ "Continue with Google"
                     â†“
3. SEES:             [Google Login Page]
                     â”œâ”€â”€ Choose account
                     â””â”€â”€ Grant permissions
                     â†“
4. AUTO REDIRECT:    [Your Dashboard]
                     â”œâ”€â”€ âœ… Toast: "Logged in with Google!"
                     â””â”€â”€ User data loaded

â±ï¸ Total time: ~3 seconds
```

---

This visual representation shows how all the pieces work together! ðŸŽ¯
